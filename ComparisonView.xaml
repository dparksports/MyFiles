<UserControl x:Class="FileLister.ComparisonView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="800">
    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="250"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <TextBlock Text="File Comparison &amp; History" FontSize="18" FontWeight="Bold" Margin="0,0,0,10"/>

        <!-- History Section (Split) -->
        <Grid Grid.Row="1" Margin="0,0,0,10">
            <Grid.Resources>
                <ContextMenu x:Key="HistoryRowMenu">
                    <MenuItem Header="Set as Old File (Base)" Click="HistorySetBase_Click"/>
                    <MenuItem Header="Set as New File (Target)" Click="HistorySetTarget_Click"/>
                </ContextMenu>
                <Style x:Key="HistoryRowStyle" TargetType="DataGridRow">
                    <Setter Property="ContextMenu" Value="{StaticResource HistoryRowMenu}"/>
                </Style>
            </Grid.Resources>
            
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="10"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Simple List History -->
            <GroupBox x:Name="SimpleHistoryGroup" Grid.Column="0" Header="Simple File Scans">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <DataGrid x:Name="SimpleHistoryGrid" AutoGenerateColumns="False" IsReadOnly="True" SelectionMode="Extended" RowStyle="{StaticResource HistoryRowStyle}">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Timestamp" Binding="{Binding Timestamp}" Width="140"/>
                            <DataGridTextColumn Header="Integrity" Binding="{Binding VerificationStatus}" Width="80"/>
                            <DataGridTextColumn Header="File Path" Binding="{Binding FilePath}" Width="*"/>
                        </DataGrid.Columns>
                    </DataGrid>
                    <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,5,0,0">
                        <Button Content="Browse &amp; Add..." Margin="0,0,10,0" Padding="10,5" Click="BrowseSimple_Click"/>
                        <Button Content="Compare Selected" Padding="10,5" Click="CompareSimple_Click"/>
                    </StackPanel>
                </Grid>
            </GroupBox>

            <!-- Checksum History -->
            <GroupBox x:Name="ChecksumHistoryGroup" Grid.Column="2" Header="Checksum Manifests">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <DataGrid x:Name="ChecksumHistoryGrid" AutoGenerateColumns="False" IsReadOnly="True" SelectionMode="Extended" RowStyle="{StaticResource HistoryRowStyle}">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Timestamp" Binding="{Binding Timestamp}" Width="140"/>
                            <DataGridTextColumn Header="Integrity" Binding="{Binding VerificationStatus}" Width="80"/>
                            <DataGridTextColumn Header="File Path" Binding="{Binding FilePath}" Width="*"/>
                        </DataGrid.Columns>
                    </DataGrid>
                    <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,5,0,0">
                        <Button Content="Browse &amp; Add..." Margin="0,0,10,0" Padding="10,5" Click="BrowseChecksum_Click"/>
                        <Button Content="Compare Selected" Padding="10,5" Click="CompareChecksum_Click"/>
                    </StackPanel>
                </Grid>
            </GroupBox>
        </Grid>

        <!-- Selected Files Confirmation (Replaces Manual Selection) -->
        <Border x:Name="ComparisonSelectionBorder" Grid.Row="2" Margin="0,0,0,10" Background="#FAFAFA" BorderBrush="#DDDDDD" BorderThickness="1" CornerRadius="4" Padding="10" Visibility="Collapsed">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <TextBlock Text="Base (Old): " FontWeight="Bold" Grid.Column="0" VerticalAlignment="Center"/>
                <TextBlock x:Name="SelectedBaseText" Text="None" Grid.Column="1" Margin="5,0,15,0" TextTrimming="CharacterEllipsis" Foreground="DarkBlue" VerticalAlignment="Center"/>

                <TextBlock Text="Target (New): " FontWeight="Bold" Grid.Column="2" VerticalAlignment="Center"/>
                <TextBlock x:Name="SelectedTargetText" Text="None" Grid.Column="3" Margin="5,0,0,0" TextTrimming="CharacterEllipsis" Foreground="DarkGreen" VerticalAlignment="Center"/>
            </Grid>
        </Border>

        <StackPanel Grid.Row="3" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,0,10">
            <StackPanel x:Name="ModeSelectionPanel" Orientation="Horizontal">
                <TextBlock Text="Mode:" VerticalAlignment="Center" Margin="0,0,10,0"/>
                <ComboBox x:Name="ModeCombo" SelectedIndex="0" Width="200" Margin="0,0,10,0">
                    <ComboBoxItem Content="Checksum Comparison (Detailed)"/>
                    <ComboBoxItem Content="Simple File List Comparison"/>
                </ComboBox>
            </StackPanel>
        </StackPanel>

        <DataGrid x:Name="ResultsGrid" Grid.Row="5" AutoGenerateColumns="False" IsReadOnly="True" Margin="0,0,0,10">
            <DataGrid.Resources>
                <ContextMenu x:Key="RowMenu">
                    <MenuItem Header="Copy Full Path" Click="CopyPath_Click"/>
                </ContextMenu>
            </DataGrid.Resources>
            <DataGrid.RowStyle>
                <Style TargetType="DataGridRow">
                    <Setter Property="ContextMenu" Value="{StaticResource RowMenu}" />
                </Style>
            </DataGrid.RowStyle>
            <DataGrid.Columns>
                <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="100"/>
                <DataGridTextColumn Header="File Path" Binding="{Binding FilePath}" Width="*"/>
                <DataGridTextColumn Header="Details" Binding="{Binding Details}" Width="200"/>
            </DataGrid.Columns>
        </DataGrid>

        <Button Grid.Row="6" Content="Export Report to CSV" HorizontalAlignment="Right" Padding="10,5" Click="Export_Click"/>
    </Grid>
</UserControl>
